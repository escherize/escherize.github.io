!function(){var e="undefined"!=typeof module&&module.require,n=e?module.exports:window.paredit={};e&&(n.reader=module.require("./lib/reader").reader,n.navigator=module.require("./lib/navigator").navigator,n.editor=module.require("./lib/editor").editor),n.parse=function(e,t){t=t||{};var r=t.hasOwnProperty("addSourceForLeafs")?t.addSourceForLeafs:!0,i=[],o=n.reader.readSeq(e,function(n,t,o,u,l){var a={type:n,start:o.idx,end:u.idx};return"error"===n?(a.error=t.error,i.push(a)):r&&"list"!==n&&(a.source=e.slice(a.start,a.end)),"list"===n&&(a.children=t),("list"===n||"string"===n)&&(a.open=l.open,a.close=l.close),a});return{type:"toplevel",start:0,end:o&&o.length&&o[o.length-1].end||0,errors:i,children:o}}}(),function(e){var n="undefined"!=typeof module&&module.require,t=n?module.exports:window.paredit;e(t)}(function(e){var n=e.util={merge:function(e){return arguments.length>1?n.merge(Array.prototype.slice.call(arguments)):Array.isArray(e[0])?Array.prototype.concat.apply([],e):e.reduce(function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t]);return e},{})},mapTree:function(e,t,r){var i=(r(e)||[]).map(function(e){return n.mapTree(e,t,r)});return t(e,i)},flatFilterTree:function(e,t,r){var i=[];return t(e)&&i.push(e),i.concat((r(e)||[]).reduce(function(e,i){return e.concat(n.flatFilterTree(i,t,r))},[]))},last:function(e){return e[e.length-1]},times:function(e,n){return new Array(e+1).join(n)},clone:function(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var n={};for(var t in e)n[t]=e[t];return n}}}),function(e){var n="undefined"!=typeof module&&module.require,t=n?module.exports:window.paredit;e(t)}(function(e){function n(e,n,f,p,g){var v=n[0];if(!v&&e&&y[e])return{input:n,context:f,pos:p,flag:w};if(!v&&!y[e])return{input:n,context:f,pos:p,flag:w};if(/\s|,/.test(v))return{input:n.slice(1),context:f,pos:x(p,v)};if(b.test(v))return a(n,f,p,g);if(";"===v)return l(n,f,p,g);if('"'===v)return r(n,f,p,g);if("\\"===v)return i(n,f,p,g);if(/[0-9]/.test(v))return u(n,f,p,g);if(I.test(v))return o(n,f,p,g);if(A.indexOf(v)>-1){if(!e){var C=c(n,f,p,g);return{input:C.input,context:C.context,pos:C.pos}}return{input:n,context:f,pos:p,flag:m}}if(S.indexOf(v)>-1){var k,O,q=h(p),F=t(v,n.slice(1),Object.freeze([]),x(p,v),g),T=F.input[0];if(T!==y[v]){var j=h(F.pos),E="Expected '"+y[v]+"'"+(T?" but got '"+T+"'":" but reached end of input"),R=s(E,q,j);k=d(g,"error",R,q,j),O=T?x(F.pos,T):F.pos}else O=T?x(F.pos,T):F.pos,k=d(g,"list",F.context,q,O,{open:v,close:y[v]});f=f.concat([k]);var L=F.input.slice(T?1:0);return{input:L,context:f,pos:O}}var q=h(p),j=x(p,v),R=s("Unexpected character: "+v,q,j);return R=d(g,"error",R,q,j),f=f.concat([R]),{input:n.slice(1),context:f,pos:j}}function t(e,t,r,i,o){for(var u,l=0;;){if(l++,l>1e4)throw new Error("endless loop at "+g(i));if(u=n(e,t,r,i,o),t=u.input,r=u.context,i=u.pos,u.flag===w||u.flag===m&&(e||!t.length))break}return{input:t,context:r,pos:i}}function r(e,n,t,r){var i=!1,o=h(t),u=e[0];return t=x(t,e[0]),e=e.slice(1),f(e,t,function(e){return i||'"'!==e?(i?i=!1:"\\"===e&&(i=!0),!0):!1},function(e,t,i,l){u=u+e+t[0],l=x(l,t[0]),t=t.slice(1);var a=d(r,"string",u,o,l,{open:'"',close:'"'});return n=n.concat([a]),{pos:l,input:t,context:n}})}function i(e,n,t,r){var i=h(t),o=e.slice(0,2),u=x(t,o),l=d(r,"char",o,i,u),a=e.slice(2);return n=n.concat([l]),{pos:u,input:a,context:n}}function o(e,n,t,r){return f(e,t,function(e){return I.test(e)},function(e,t,i,o){var u=d(r,"symbol",e,i,o);return n=n.concat([u]),{pos:o,input:t,context:n}})}function u(e,n,t,r){return f(e,t,function(e){return/[0-9]/.test(e)},function(e,t,i,o){var u=d(r,"number",Number(e),i,o);return n=n.concat([u]),{pos:o,input:t,context:n}})}function l(e,n,t,r){for(var i=h(t),o="",u=e;u.length&&/^\s*;/.test(u);){var l=v(u);o+=l[0],u=l[1]}var a=x(t,o),c=d(r,"comment",o,i,a);return n=n.concat([c]),{pos:a,input:u,context:n}}function a(e,n,t,r){var i=h(t),o=e.slice(0,1),u=x(t,o),l=d(r,"special",o,i,u),a=e.slice(1);return n=n.concat([l]),{pos:u,input:a,context:n}}function c(e,n,t,r){return f(e,t,function(e){return A.indexOf(e)>-1},function(e,t,i,o){var u=s("Unexpected input: '"+e+"'",i,o),l=d(r,"error",u,i,o);return n=n.concat([l]),{pos:o,input:t,context:n}})}function s(e,n,t){return{error:e+" at line "+(t.row+1)+" column "+t.column,start:h(n),end:h(t)}}function d(e,n,t,r,i,o){return e?e(n,t,h(r),h(i),o):t}function f(e,n,t,r){for(var i=h(n),o="",u=0;u<e.length&&t(e[u]);u++)o+=e[u];return r(o,e.slice(o.length),i,x(n,o))}function p(){return{idx:0,column:0,row:0}}function h(e){return{idx:e.idx,column:e.column,row:e.row}}function g(e){return JSON.stringify(e)}function v(e){var n=e.indexOf("\n");n=n>-1?n+1:e.length;var t=e.slice(0,n),r=e.slice(n);return[t,r]}function x(e,n){if(!n)return e;e.idx+=n.length;var t=n.split("\n"),r=t.length;e.row+=r-1;var i=t[r-1].length;return e.column=r>1?i:e.column+i,e}e.reader={readSeq:function(e,n){return t(null,e,Object.freeze([]),p(),n).context},readSexp:function(e,t){return n(null,e,Object.freeze([]),p(),t).context[0]}};var m={},w={},y={"[":"]","(":")","{":"}"},S=Object.keys(y),A=S.map(function(e){return y[e]}),I=/[^\s\[\]\(\)\{\},"\\`@^#~]/,b=/[`@^#~]/}),function(e){var n="undefined"!=typeof module&&module.require,t=n?module.exports:window.paredit,r=n?module.require("./util").util:window.paredit.util;e(r,t)}(function(e,n){function t(e){return e[e.length-1]}function r(e){return e.children||[]}var i=n.navigator={forwardSexp:function(e,n){var r=t(o.containingSexpsAt(e,n,function(e){return!o.hasChildren(e)}));if(r)return r.end;var i=o.nextSexp(e,n);return i?i.end:n},backwardSexp:function(e,n){var r=t(o.containingSexpsAt(e,n,function(e){return!o.hasChildren(e)}));if(r)return r.start;var i=o.prevSexp(e,n);return i?i.start:n},forwardDownSexp:function(e,n){var t=o.nextSexp(e,n,function(e){return"list"===e.type});return t?t.children&&t.children[0]?t.children[0].start:t.start+1:n},backwardUpSexp:function(e,n){var r=o.containingSexpsAt(e,n,function(e){return"list"===e.type||"string"===e.type||"comment"===e.type});return r&&r.length?t(r).start:n},closeList:function(e,n){var r=o.containingSexpsAt(e,n),i=t(r);if(!i||"toplevel"===i.type)return n;if("string"===i.type||"comment"===i.type)return void 0;var u=r.filter(o.hasChildren);return t(u).end},sexpRange:function(e,n){return i.sexpRangeExpansion(e,n,n)},sexpRangeExpansion:function(n,i,u){if(i!==u){var l=t(o.sexpsAt(n,i,function(e){return e.start===i})),a=l&&t(o.sexpsAt(n,u,function(e){return e.end===u}));if(l&&a){var c=t(o.sexpsAt(n,i,function(e){return e.start<i&&!o.hasChildren(e)}));if(c)return[c.start,u];var s=t(o.sexpsAt(n,u,function(e){return u<e.end&&!o.hasChildren(e)}));if(s)return[i,s.end]}}var d=t(e.flatFilterTree(n,function(e){return"toplevel"===e.type?!1:i===u?e.start<=i&&u<=e.end:e.start===i?u<e.end:e.end===u?e.start<i:e.start<i&&u<e.end},r));if(!d)return null;var f=d.start===i||d.end===u;if("list"===d.type||"string"===d.type){if(f&&(i===d.start||u===d.end))return[d.start,d.end];if(d.start+1<i||u<d.end-1)return[d.start+1,d.end-1]}return[d.start,d.end]},rangeForDefun:function(e,n){var t=e.children&&e.children.filter(function(e){return e.start<=n&&n<=e.end})[0];return t?[t.start,t.end]:null}},o=n.walk={hasChildren:function(e){return"list"===e.type||"toplevel"===e.type},containingSexpsAt:function(n,t,i){return e.flatFilterTree(n,function(e){return("toplevel"===e.type||e.start<t&&t<e.end)&&(!i||i(e))},r)},sexpsAt:function(n,t,i){return e.flatFilterTree(n,function(e){return e.start<=t&&t<=e.end&&(!i||i(e))},r)},nextSexp:function(n,i,u){var l=e.flatFilterTree(n,function(e){return e.start<=i&&i<e.end&&o.hasChildren(e)},r);if(!l.length)return null;var a=l.filter(function(e){return e.start===i&&"toplevel"!==e.type})[0];if(a)return a;var c=t(l).children.filter(function(e){return i<=e.start&&(!u||!!u(e))});return c.length?c[0]:null},prevSexp:function(n,i,u){var l=e.flatFilterTree(n,function(e){return e.start<i&&i<=e.end&&o.hasChildren(e)},r);if(!l.length)return null;var a=l.filter(function(e){return e.end===i&&"toplevel"!==e.type})[0];if(a)return a;var c=t(l).children.filter(function(e){return e.end<=i&&(!u||!!u(e))});return c.length?t(c):null},stringify:function(n){return e.mapTree(n,function(t,r){return"list"===t.type||"toplevel"===t.type?"("+r.join(" ")+")":t.source?t.source:e.times(n.end-n.start,"x")},function(e){return e&&e.children||[]})},source:function(e,n){return n.source?n.source:e.slice(n.start,n.end)}}}),function(e){var n="undefined"!=typeof module&&module.require,t=n?module.exports:window.paredit,r=n?module.require("./util").util:window.paredit.util,i=n?module.require("./navigator").navigator:window.paredit.navigator,o=n?module.require("./navigator").walk:window.paredit.walk;e(i,o,r,t)}(function(e,n,t,r){function i(e,n){return e.slice(0,n).lastIndexOf("\n")+1}function o(e,n){return n-i(e,n)}function u(e,n,t){if("toplevel"===n.type)return 0;var r=s(n,t);return f(n,e)?o(e,n.start+n.open.length+1):r.length<=1||"("!==n.open?o(e,n.start+n.open.length):o(e,r[1].start)}function l(e){return e[e.length-1]}function a(e,n){return new Array(e+1).join(n)}function c(e,n){return t.mapTree(n,function(n,r){return t.merge(n,{start:n.start+e,end:n.end+e,children:r})},function(e){return e.children})}function s(e,n){return e.children.filter(function(e){return e.end<=n})}function d(e,n){return e.children.filter(function(e){return n<=e.start})}function f(e,t){if(!n.hasChildren(e)||!e.children.length)return!1;var i=e.children[0].source;return i?r.specialForms.some(function(n){return"string"==typeof n?n===i:"function"==typeof n?n(i,e.children[0]):n instanceof RegExp?n.test(i):!1}):!1}r.specialForms=["&","monitor-exit",/^case/,"try",/^reify/,"finally",/^(.*-)?loop/,/^do/,/^let/,/^import/,"new",/^deftype/,/^let/,"fn","recur",/^set.*!$/,".","var","quote","catch","throw","monitor-enter","ns","in-ns",/^([^\/]+\/)?def/,/^if/,/^when/,/->/,"while","for",/(^|\/)with/,"testing","while","cond","condp","apply","binding","locking","proxy","reify",/^extend/,"facts"];var p=r.editor={rewrite:function(e,r,i){var o=i.length?l(i).end-r.end:r.start-r.end,u=n.containingSexpsAt(e,r.start),a=u.reduceRight(function(e,n){var r,i=n.children.indexOf(e.original);r=i>-1?n.children.slice(0,i).concat(e.nodes).concat(n.children.slice(i+1).map(c.bind(null,o))):n.children;var u=t.merge(n,{end:n.end+o,children:r});return{original:n,nodes:[u]}},{original:r,nodes:i});return a.nodes[0]},openList:function(e,t,r,i){i=i||{};var o=(i.count||1,i.open||"("),u=i.close||")";if(i.freeEdits||e.errors&&e.errors.length)return{changes:[["insert",r,o]],newIndex:r+o.length};var a=n.containingSexpsAt(e,r),c=l(a);if(c&&"comment"===c.type||"string"===c.type)return{changes:[["insert",r,o]],newIndex:r+o.length};if(!i.endIdx)return{changes:[["insert",r,o+u]],newIndex:r+o.length};var s=l(n.containingSexpsAt(e,r,n.hasChildren)),d=l(n.containingSexpsAt(e,i.endIdx,n.hasChildren));if(s!==d)return{changes:[["insert",r,o+u]],newIndex:r+o.length};var f=d.children.filter(function(e){return e.start<r&&r<e.end}),p=d.children.filter(function(e){return e.start<i.endIdx&&i.endIdx<e.end}),h=f[0]&&f[0]!==p[0]&&(p[0]||"symbol"!==f[0].type),g=p[0]&&f[0]!==p[0]&&(f[0]||"symbol"!==p[0].type),v=h?f[0].end:r,x=g?p[0].start:i.endIdx;return{changes:[["insert",x,u],["insert",v,o]],newIndex:v+o.length}},spliceSexp:function(e,t,r){var i=n.containingSexpsAt(e,r,n.hasChildren);if(!i.length)return null;var o=i.pop(),u="toplevel"===o.type,l=o.children.filter(function(e){return e.start<r&&r<e.end})[0],a=l&&"string"===l.type,c=[],s=r;return u||c.push(["remove",o.end-1,o.close.length]),a&&(c.push(["remove",l.end-1,l.close.length]),c.push(["remove",l.start,l.open.length]),s-=l.open.length),u||(c.push(["remove",o.start,o.open.length]),s-=o.open.length),{changes:c,newIndex:s}},spliceSexpKill:function(e,t,r,i){i=i||{};var o=(i.count||1,i.backward),u=n.containingSexpsAt(e,r,n.hasChildren);if(!u.length)return null;if(o)var a=s(l(u),r),c=p.killSexp(e,t,r,{count:a.length,backward:!0});else var f=d(l(u),r),c=p.killSexp(e,t,r,{count:f.length,backward:!1});var h=p.spliceSexp(e,t,r);if(!c)return h;if(!h)return c;var g=Array.prototype.slice.call(h.changes);return 2===g.length?g.splice(1,0,c.changes[0]):4===g.length&&g.splice(2,0,c.changes[0]),{changes:g,newIndex:c.newIndex-(3===g.length?1:2)}},splitSexp:function(e,t,r){var i=n.containingSexpsAt(e,r);if(!i.length)return null;var o=i.pop();if("toplevel"!==o.type){if(!n.hasChildren(o)&&"string"!==o.type)return null;var u=o.close+" "+o.open,l=r+o.close.length,a=[["insert",r,u]];return{changes:a,newIndex:l}}},killSexp:function(e,t,r,i){i=i||{};var o=i.count||1,u=i.backward,a=n.containingSexpsAt(e,r,n.hasChildren);if(!a.length)return null;var c=a.pop(),f=c.children.filter(function(e){return e.start<r&&r<e.end})[0];if(f){var p=u?f.start:r,h=u?r:f.end;return"string"===f.type&&(p+=u?f.open.length:0,h+=u?0:-f.close.length),{changes:[["remove",p,h-p]],newIndex:p}}if(f&&"string"===f.type){var p=u?f.start+f.open.length:r,h=u?r:f.end-f.close.length;return{changes:[["remove",p,h-p]],newIndex:p}}if(u){var g=s(c,r);if(!g.length)return null;var v=g.slice(-o)[0].start,x=[["remove",v,r-v]],m=v}else{var w=d(c,r);if(!w.length)return null;var m=r,x=[["remove",r,l(w.slice(0,o)).end-r]]}return{changes:x,newIndex:m}},wrapAround:function(e,t,r,i,o,u){var a=u&&u.count||1,c=n.containingSexpsAt(e,r,n.hasChildren);if(!c.length)return null;var s=l(c),d=s.children.filter(function(e){return e.start>=r}).slice(0,a),f=l(d),p=[["insert",r,i],["insert",(f?f.end:r)+i.length,o]];return{changes:p,newIndex:r+i.length}},closeAndNewline:function(e,t,r,i){i=i||")";var u=n.containingSexpsAt(e,r,function(e){return n.hasChildren(e)&&e.close===i});if(!u.length)return null;var c=l(u),s=a(o(t,c.start)," "),d="\n"+s,f=[["insert",c.end,d]];return{changes:f,newIndex:c.end+d.length}},barfSexp:function(e,t,r,i){var o=i&&i.backward,u=n.containingSexpsAt(e,r,n.hasChildren);if(!u.length)return null;var a=l(u),c=l(n.containingSexpsAt(e,r));if(c===a&&(c=null),o){var f=s(a,r);if(!f.length)return null;var p=[["insert",f[1]?f[1].start:c?c.start:r,a.open],["remove",a.start,a.open.length]]}else{var h=d(a,r);if(!h.length)return;var p=[["remove",a.end-a.close.length,a.close.length],["insert",h[h.length-2]?h[h.length-2].end:c?c.end:r,a.close]]}return{changes:p,newIndex:r}},slurpSexp:function(e,t,r,i){var o=i&&i.backward,u=i.count||1,a=n.containingSexpsAt(e,r,n.hasChildren);if(a.length<2)return null;var c=a.pop(),f=a.pop();if(o){var p=s(f,r);if(!p.length)return;var h=[["remove",c.start,c.open.length],["insert",p.slice(-u)[0].start,c.open]]}else{var g=d(f,r);if(!g.length)return;var h=[["insert",l(g.slice(0,u)).end,c.close],["remove",c.end-c.close.length,c.close.length]]}return{changes:h,newIndex:r}},transpose:function(e,t,r,i){i=i||{};var o=n.containingSexpsAt(e,r,n.hasChildren),u=l(o),a=s(u,r),c=d(u,r);if(u.children.some(function(e){return e.start<r&&r<e.end}))return null;if(!a.length||!c.length)return null;var f=l(a),p=c[0],h=t.slice(f.end,p.start)+n.source(t,f);return{changes:[["insert",p.end,h],["remove",f.start,p.start-f.start]],newIndex:r-(f.end-f.start)+(p.end-p.start)}},"delete":function(e,t,r,i){function o(e){return("string"===e.type||"list"===e.type)&&e.end-e.start===e.open.length+e.close.length}function u(e){return{changes:[["remove",e.start,e.end-e.start]],newIndex:e.start}}function a(e){return"symbol"===e.type||"comment"===e.type||"number"===e.type||"special"===e.type}i=i||{};var c=i.count||1,f=!!i.backward,p=i.endIdx;if(i.freeEdits||e.errors&&e.errors.length)return p?{changes:[["remove",r,p-r]],newIndex:r}:{changes:[["remove",f?r-c:r,c]],newIndex:f?r-c:r};var h=n.containingSexpsAt(e,r),g=h.filter(function(e){return n.hasChildren(e)}),v=l(g),x=l(h),m="number"==typeof p;if(m){var w=l(n.containingSexpsAt(e,p,n.hasChildren));if(v!==w)return null;var y=l(n.sexpsAt(v,r)),S=l(n.sexpsAt(v,p)),A=!a(y)&&y.start===r,I=!a(S)&&S.end===p;if(y===S&&(A&&!I||!A&&I))return null;if((S!==v&&!a(S)&&!I||y!==v&&!a(y)&&!A)&&y!==S)return null;if(-1===v.children.indexOf(y)&&y!==v||-1===v.children.indexOf(S)&&S!==v)return null;var b=Math.min(r,p),C=Math.max(r,p);return{changes:[["remove",b,C-b]],newIndex:b}}var k=v===x,O=k&&s(v,r),q=k&&d(v,r),F={changes:[],newIndex:r},T={changes:[["remove",f?r-c:r,c]],newIndex:f?r-c:r};if(!k&&"comment"===x.type)return T;if(O&&O.length&&f){var j=l(O);return j.end!==r||a(j)?T:o(j)||"char"===j.type?u(j):F}if(q&&q.length&&!f){var j=q[0];return j.start!==r||a(j)?T:o(j)||"char"===j.type?u(j):F}k||(v=x);var E=r===v.start+(v.open?v.open.length:0),R=r===v.end-(v.close?v.close.length:0);return v.children&&v.children.length||!(E&&f||R&&!f)?E&&f&&(k?v.children.length:v.end-v.start>1)?F:R&&!f&&(k?v.children.length:v.end-v.start>1)?F:T:u(v)},indentRange:function(e,r,o,s){var f=i(r,o),h=r.slice(s).indexOf("\n");h=h>-1?h+s:r.length;var g=r.slice(f,h).split("\n");return g.reduce(function(e,r){var i=e.idx,o=e.changes,s=e.ast,f=e.src,h=n.containingSexpsAt(s,i,n.hasChildren),g=l(h);if(!g)return{idx:i+r.length+1,newIndex:i,changes:o,ast:s,src:f};var v=r.match(/^\s*/)[0],x=u(f,g,i)-v.length,m=r.length+x;if(x>0){var w=a(x," ");o.push(["insert",i,w]),f=f.slice(0,i)+w+f.slice(i)}else 0>x&&(o.push(["remove",i,-x]),f=f.slice(0,i)+f.slice(i-x));var y=d(g,i)[0];if(y){var S=c(x,y);s=p.rewrite(s,y,[S])}else s=p.rewrite(s,g,[t.merge(g,{end:g.end+x})]);return{idx:i+m+1,newIndex:i+x,changes:o,ast:s,src:f}},{idx:f,changes:[],ast:e,src:r})}}});